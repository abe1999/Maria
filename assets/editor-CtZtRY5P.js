import"./variables-lgvELO44.js";import"./auth-guard-DRnqYiFg.js";import{r as b,i as D,u as T,j as k,T as R,a as v,d as c,k as C,m as P,c as S,b as U}from"./firebase-config-C2qK9jP1.js";const u=document.getElementById("editor-title"),F=document.getElementById("event-form"),p=document.getElementById("title"),y=document.getElementById("date"),E=document.getElementById("excerpt"),f=document.getElementById("fullText"),I=document.getElementById("imageUpload"),s=document.getElementById("image-preview"),w=document.getElementById("current-image-path"),h=document.getElementById("category"),B=document.getElementById("link"),r=document.getElementById("save-button"),L=document.getElementById("upload-progress-container"),$=document.getElementById("upload-progress"),N=document.getElementById("upload-progress-text"),A=new URLSearchParams(window.location.search),d=A.get("id"),x=!!d;let a="";async function M(){if(!x){u.textContent="Adicionar Novo Evento";return}try{u.textContent="Editar Evento";const o=v(c,"eventos",d),t=await U(o);if(t.exists()){const e=t.data();p.value=e.title||"",y.value=e.date?e.date.toDate().toISOString().split("T")[0]:"",E.value=e.excerpt||"",f.value=e.fullText||"",h.value=e.category||"noticia",B.value=e.link||"",e.image&&(a=e.image,s.src=a,s.style.display="block",w.textContent=`Imagem atual: ${a.split("/").pop().split("?")[0]}`)}else alert("Evento não encontrado!"),window.location.href="/src/admin/dashboard.html"}catch(o){console.error("Erro ao carregar evento:",o),alert("Não foi possível carregar os dados do evento.")}}I.addEventListener("change",o=>{const t=o.target.files[0];if(t){const e=new FileReader;e.onload=l=>{s.src=l.target.result,s.style.display="block"},e.readAsDataURL(t),w.textContent=`Nova imagem selecionada: ${t.name}`}});F.addEventListener("submit",async o=>{o.preventDefault(),r.disabled=!0,r.textContent="Salvando...";const t=I.files[0];try{if(t){const e=`eventos/${Date.now()}-${t.name}`,l=b(D,e),i=T(l,t);i.on("state_changed",n=>{const m=n.bytesTransferred/n.totalBytes*100;L.style.display="block",$.value=m,N.textContent=`Enviando imagem: ${Math.round(m)}%`},n=>{throw console.error("Erro no upload:",n),new Error("Falha ao enviar a imagem.")},async()=>{a=await k(i.snapshot.ref),console.log("URL pública da imagem:",a),await g()})}else await g()}catch(e){console.error("Erro no processo de salvamento:",e),alert(`Erro ao salvar: ${e.message}`),r.disabled=!1,r.textContent="Salvar Evento"}});async function g(){const o={title:p.value,date:R.fromDate(new Date(y.value+"T00:00:00")),excerpt:E.value,fullText:f.value,category:h.value,link:B.value,image:a};try{if(x){const t=v(c,"eventos",d);await C(t,o),alert("Evento atualizado com sucesso!")}else await P(S(c,"eventos"),o),alert("Evento cadastrado com sucesso!");window.location.href="dashboard.html"}catch(t){throw console.error("Erro ao salvar no Firestore:",t),new Error("Falha ao salvar os dados no banco de dados.")}}M();
